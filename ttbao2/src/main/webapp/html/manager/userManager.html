<table id="table">
</table>
<div id="diaAdd" style="width:100%;max-width:600px;padding:30px 60px;" hidden>
  <form id="ff" method="post">
    <div style="margin-bottom:7px;height: 130px">
      <div class="control-group js_uploadBox">
        <div class="btn-upload">
          <a href="javascript:void(0);"><i class="icon-upload"></i><span class="js_uploadText">上传</span>图片</a>
          <input class="js_upFile" type="file" name="cover">
        </div>

        <div class="js_showBox " style="width: 50%;height: 50% ;margin-top: 7px">
          <img class="js_logoBox" src="" style="height: 100px;width: 100px" showBox >
        </div>
      </div>
    </div>
    <div style="margin-bottom:7px">
      <input class="easyui-textbox" style="width:100%" name="username" data-options="label:'登录名:',required:true">
    </div>
    <div style="margin-bottom:7px">
      <input class="easyui-textbox" style="width:100%" name="password" data-options="label:'用户密码:',required:true">
    </div>
    <div style="margin-bottom:7px">
      <select class="easyui-combobox" style="width:30%" name="gender" data-options="label:'性别:',required:true">
        <option value="0">女</option>
        <option value="1">男</option>
      </select>
    </div>
    <div style="margin-bottom:7px">
      <input id="birthdaybox" class="easyui-datebox" style="width:50%" name="birthday" data-options="label:'生日:'">
    </div>
    <div style="margin-bottom:7px">
      <input class="easyui-textbox" style="width:100%" name="vsername" data-options="label:'用户名称:',required:true">
    </div>
    <div style="margin-bottom:7px">
      <input class="easyui-textbox" style="width:100%" name="mobile" data-options="label:'电话号码:',required:true">
    </div>
    <div style="margin-bottom:7px">
      <input class="easyui-textbox" style="width:100%" name="email"
             data-options="label:'电子邮件:',required:true,validType:'email'">
    </div>
  </form>
</div>
<script type="text/javascript" src="../js/imageupload.js"></script>
<script type="text/javascript">

  $(function () {

    var toolbar = [{
      text: '添加用户',
      iconCls: 'icon-add',
      handler: function () {
        $('#diaAdd').dialog({
          title: ' 添加用户',
          width: 600,
          height: 800,
          iconCls: 'icon-add',                 //弹出框图标
          modal: true,
          buttons: [{
            text: '保存',
            iconCls: 'icon-ok',
            handler: function () {
              $('#ff').form('submit', {
                url: 'user',
                success: function (data) {
                  console.log(data);
                }
              });
            }
          }, {
            text: '取消',
            iconCls: 'icon-cancel',
            handler: function () {
              $('#diaAdd').dialog('close');
            }
          }
            ,{
              text: '加载',
              iconCls: 'icon-cancel',
              handler: function () {
                $('#ff').form('load',{
                  username:'name2',
                  password:'pasasdasdasd',
                  email:'mymail@gmail.com',
                  vsername:'subject2',
                  mobile:'13798986854',
                  gender:'1',
                  birthday:'2017-05-19'
                });
              }
            }
          ]
        });
      }
    }, {
      text: '编辑用户',
      iconCls: 'icon-edit',
      handler: function () {

      }
    }, '-', {
      text: 'Save',
      iconCls: 'icon-save',
      handler: function () {
        alert('save')
      }
    }];

    $('#table').datagrid({
      url: 'userlist',
      method: "GET",
      toolbar: toolbar,
      rownumbers: true,
      singleSelect: true,
      pagination: true,
      pageNumber: 1,
      pageSize: 20,
      columns: [[
        {field: 'userid', title: '用户ID', width: 100, align: 'right'},
        {field: 'username', title: '登录名', width: 150, align: 'right'},
        {field: 'password', title: '用户密码', width: 100, align: 'right'},
        {field: 'gender', title: '性别', width: 100, align: 'right'},
        {field: 'birthday', title: '生日', width: 100, align: 'right'},
        {field: 'vsername', title: '用户名称', width: 100, align: 'right'},
        {field: 'mobile', title: '电话号码', width: 100, align: 'right'},
        {field: 'email', title: '电子邮件', width: 100, align: 'right'},
        {field: 'gen_date', title: '创建日期', width: 100, align: 'right'},
        {field: 'last_login_time', title: '最后登录日期', width: 150, align: 'right'},
        {field: 'count', title: '登录次数', width: 100, align: 'right'}
      ]],
      loadFilter: function (data) {
        data.rows.forEach(function (da) {
          da.birthday = dataFormat(da.birthday);
          da.gen_date = dataFormat(da.gen_date);
          da.last_login_time = dataFormat(da.last_login_time);
          da.gender = genderFormat(da.gender);
        });
        return data;
      }
    })
  });

  $(".js_upFile").uploadView({
    uploadBox: '.js_uploadBox',//设置上传框容器
    showBox : '.js_showBox',//设置显示预览图片的容器
    width : 100, //预览图片的宽度，单位px
    height : 100, //预览图片的高度，单位px
    allowType: ["gif", "jpeg", "jpg", "bmp", "png"], //允许上传图片的类型
    maxSize :2, //允许上传图片的最大尺寸，单位M
    success:function(e){
      $(".js_uploadText").text('更改');
    }
  });

  function dataFormat(data) {
    var tda = new Date(data);
    var year = tda.getFullYear();
    var month = tda.getMonth() + 1;
    var date = tda.getDate();
    var dataStr = [year, month, date].join('-');
    return dataStr;
  }
  function genderFormat(gender) {
    if (gender == 0) {
      return '女';
    } else {
      return '男';
    }
  }
</script>